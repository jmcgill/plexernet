// This program uses the Maps Engine API to implement the behaviour of
// the radius search example web page.

// Map variable, so we can add markers to the map.
var client;
var oauth_token;

function bind(scope, fn) {
  var args = Array.prototype.slice.call(arguments, 2);
  return function() {
    return fn.apply(scope, Array.prototype.slice.call(arguments).concat(args));
  }
};

function initialize() {
  initializeAuth(handleAccessToken, handleAccessToken);
}

function handleAccessToken(token) {
  // The token has been verified, so we can now cache it.
  oauth_token = token;

  // Find all the features in the table.
  var url = "https://www.googleapis.com/mapsengine/v1beta2/tables/10258059232491603613-13364521397325580695/features";
  parameters = {
    access_token: oauth_token,
  };

  jQuery.ajax({
    url: url,
    data: parameters,
    success: handleApiResponse,
    error: handleApiError
  });
}

function handleApiResponse(response) {
  var table = new Table(response.schema, $("#table"));
  table.SetData(response.features);

  $("#add_a_row").click(function() {
    table.AddEmptyRow();
  });
}

// TODO(jmcgill): Move into class.
function handleApiError(obj, textStatus, errorThrown) {
  var response = JSON.parse(obj.responseText);
  var str = JSON.stringify(response, undefined, 2);
  alert('An error occured - see the Javascript Console for deatils.');
  window.console.log(str);
}

function handleEditResponse(response) {
}

function handleDeleteResponse(tr) {
  tr.remove(); 
}
