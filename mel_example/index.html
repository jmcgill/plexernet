
<html>
<head>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=false"></script>
<script src="https://apis.google.com/js/client.js"></script>
<script type="text/javascript">
// The Client ID for your application, as configured on the Google APIs console.
var  clientId = '57681607714-aduf3qj266i45g3euj9b8arn22b6fuu3.apps.googleusercontent.com';

// The oauth scope for displaying Maps Engine data.
var scopes = 'https://www.googleapis.com/auth/earthbuilder.readonly';

// This function is run when the page (including the Maps API and Google APIs
// client libraries) have finished loading.
function initialize() {
  checkAuth(handleAuthResult);
  // window.setTimeout(checkAuth, 1);
}

// A shared function which checks if the user has previously authorized this
// application, and if so calls the supplied callback.
// This function should always be called before calling a function which
// requires an oauth access_token.
function checkAuth(callback) {
  var options = {
    client_id: clientId,
    scope: scopes,

    // Setting immediate to 'true' will avoid prompting the user for
    // authorization if they have already granted it in the past.
    immediate: true
  }

  // Check to see if the current user has authorized this application.
  gapi.auth.authorize(options, callback);
}

// A callback run after checking if the user has authorized this application.
// If they have not, then authResult will be null, and a button will be
// displayed which the user can click to begin authorization.
//
// Authorization can only be started in response to a user action (such as
// clicking a button) in order to avoid triggering popup blockers.
function handleAuthResult(authResult) {
  var authorizeButton = document.getElementById('authorize_button');

  // Has the user authorized this application?
  if (authResult && !authResult.error) {
    // The application is authorized. Hide the 'Authorization' button.
    authorizeButton.style.display = 'none';
    showMap(authResult.access_token);
  } else {
    // The application has not been authorized. Start the authorization flow
    // when the user clicks the button.
    authorizeButton.style.display = '';
    authorizeButton.onclick = handleAuthClick;
  }
}

// This function is called when the user clicks the Authorization button. It
// starts the authorization flow.
function handleAuthClick(event) {
  checkAuth(handleAuthResult);
  return false;
}


// This function is called once handleAuthResult detects that authorization
// has been provided.
function showMap(access_token, expires_in) {
  // Create a new Google Maps API Map
  var mapOptions = {
    center: new google.maps.LatLng(0,0),
    zoom: 4,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(
      document.getElementById("map_canvas"),
      mapOptions);

  // Add a Maps Engine Layer to this Map. The access_token granted by the oauth
  // flow is used here to access user data.
  mapsEngineLayer = new google.maps.visualization.MapsEngineLayer({
    layerId: '10258059232491603613-08645155700905327807',
    oAuthToken: access_token
  });
  mapsEngineLayer.setMap(map);

  // Add an event listener which modifies the bounds of the Map to best fit
  // the Layer once the layer has loaded.
  google.maps.event.addListener(mapsEngineLayer, 'bounds_changed', function() {
    map.fitBounds(mapsEngineLayer.get('bounds'));
  });

  // The access_token provided by the oauth flow is only valid for a certain
  // amount of time. Add a timer which will refresh the access_token after this
  // amount of time has elapsed, so that the Layer will continue to work.
  window.setTimeout(refreshToken, expires_in * 1000);
}

// This function is called once the oauth token has expired. It starts an
// oauth flow in the background which obtains a new token. The user will not
// be prompted to do anything, because we set the 'immediate' property on the
// gapi.auth.authorize request to true.
function refreshToken() {
  checkAuth(refreshLayer);
}

// This function is called once an expired access_token has been refreshed, and
// a new access_token is available.
function refreshLayer(authResult) {
  // Update the token provided to the MapsEngineLayer.
  mapsEngineLayer.set('oAuthToken', authResult.access_token);

  // This token will also expire after some time, so create a timer which will
  // refresh it again.
  window.setTimeout(refreshToken, expires_in * 1000);
}
</script>
</head>
<body onload="initialize()">
<input type="button" value="Authorize" id="authorize_button"></input>
<div id="map_canvas" style="height: 100%; width: 100%;">
</div>
</body>
</html>